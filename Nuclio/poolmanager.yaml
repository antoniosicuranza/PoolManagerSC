metadata:
  name: poolmanagermqtt
  labels:
    nuclio.io/project-name: iot-mqtt
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-poolmanagermqtt:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
   
    rain:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.225.162:1883"
      attributes:
        subscriptions:
          - qos: 2
            topic: iot/sensors/rain
    sun:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.225.162:1883"
      attributes:
        subscriptions:
          - qos: 2
            topic: iot/sensors/light
    temperature:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.225.162:1883"
      attributes:
        subscriptions:
          - qos: 2
            topic: iot/sensors/temperature
     time:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.225.162:1883"
      attributes:
        subscriptions:
          - qos: 2
            topic: iot/sensors/time
  build:
    functionSourceCode: dmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0Jyk7DQoNCmNvbnN0IEZVTkNUSU9OX05BTUUgPSAicG9vbG1hbmFnZXJtcXR0IjsNCi8vIFRPRE86IFNFVCBIRVJFIFlPVVIgTE9DQUwgSVANCmNvbnN0IElQID0gIjE5Mi4xNjguMjI1LjE2MjoxODgzIg0KY29uc3QgTElHSFRfVE9QSUMgPSAiaW90L2RldmljZXMvbGlnaHQiDQpjb25zdCBDT1ZFUl9UT1BJQyA9ICJpb3QvZGV2aWNlcy9jb3ZlciINCmNvbnN0IFBIT05FX1RPUElDID0gImlvdC9kZXZpY2VzL2FwcCINCmNvbnN0IENPTE9SX1RPUElDID0gImlvdC9kZXZpY2VzL2NvbG9yIg0KDQovL01pbiBwb29sIHRlbXBlcmF0dXJlDQpjb25zdCBNSU5fVEVNUEVSQVRVUkUgPSAxMA0KDQoNCnZhciBvcHRpb25zID0gew0KICAgIGhvc3Q6ICdtcXR0Oi8vJyArIElQLA0KICAgIGNsaWVudElkOiAnbXF0dGpzXycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zdWJzdHIoMiwgOCksDQogICAgdXNlcm5hbWU6ICdndWVzdCcsDQogICAgcGFzc3dvcmQ6ICdndWVzdCcsDQp9Ow0KDQp2YXIgcG93ZXIgPSAibGlnaHRfb24iDQp2YXIgY29sb3IgPSAiI0ZGRkZGRiINCnZhciByYWluID0gIm5vdF9yYWluIg0KdmFyIGNvdmVyID0gImNvdmVyX29mZiINCnZhciBzdW4gPSAieWVzIg0KdmFyIGRlc2NyaXB0aW9uID0gIm5vIg0KdmFyIHRlbXBlcmF0dXJlID0gMjUNCg0KYXN5bmMgZnVuY3Rpb24gc2VuZF90b19vbmVfdG9waWNfbXF0dCh0b3BpYywgZGF0YSkgew0KICAgIHZhciBjbGllbnQgPSBtcXR0LmNvbm5lY3QoIm1xdHQ6Ly8iICsgSVAsIG9wdGlvbnMpOw0KICAgIGNsaWVudC5vbignY29ubmVjdCcsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgY2xpZW50LnB1Ymxpc2godG9waWMsIGRhdGEsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGNsaWVudC5lbmQoKTsNCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQphc3luYyBmdW5jdGlvbiBzZW5kX3RvX3R3b190b3BpY19tcXR0KHRvcGljMSwgdG9waWMyLCBkYXRhMSwgZGF0YTIpIHsNCiAgICB2YXIgY2xpZW50ID0gbXF0dC5jb25uZWN0KCJtcXR0Oi8vIiArIElQLCBvcHRpb25zKTsNCiAgICBjbGllbnQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIGNsaWVudC5wdWJsaXNoKHRvcGljMSwgZGF0YTEsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGNsaWVudC5wdWJsaXNoKHRvcGljMiwgZGF0YTIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjbGllbnQuZW5kKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQphc3luYyBmdW5jdGlvbiBzZW5kX3RvX3RocmVlX3RvcGljX21xdHQodG9waWMxLCB0b3BpYzIsIHRvcGljMywgZGF0YTEsIGRhdGEyLCBkYXRhMykgew0KICAgIHZhciBjbGllbnQgPSBtcXR0LmNvbm5lY3QoIm1xdHQ6Ly8iICsgSVAsIG9wdGlvbnMpOw0KICAgIGNsaWVudC5vbignY29ubmVjdCcsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgY2xpZW50LnB1Ymxpc2godG9waWMxLCBkYXRhMSwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgY2xpZW50LnB1Ymxpc2godG9waWMyLCBkYXRhMiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGNsaWVudC5wdWJsaXNoKHRvcGljMywgZGF0YTMsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LmVuZCgpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgIH0pOw0KfQ0KYXN5bmMgZnVuY3Rpb24gc2VuZF90b19mb3VyX3RvcGljX21xdHQodG9waWMxLCB0b3BpYzIsIHRvcGljMyx0b3BpYzQsIGRhdGExLCBkYXRhMiwgZGF0YTMsZGF0YTQpIHsNCiAgICB2YXIgY2xpZW50ID0gbXF0dC5jb25uZWN0KCJtcXR0Oi8vIiArIElQLCBvcHRpb25zKTsNCiAgICBjbGllbnQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIGNsaWVudC5wdWJsaXNoKHRvcGljMSwgZGF0YTEsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGNsaWVudC5wdWJsaXNoKHRvcGljMiwgZGF0YTIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjbGllbnQucHVibGlzaCh0b3BpYzMsIGRhdGEzLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIGNsaWVudC5wdWJsaXNoKHRvcGljNCwgZGF0YTQsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudC5lbmQoKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQpmdW5jdGlvbiBiaW4yc3RyaW5nKGFycmF5KSB7DQogICAgdmFyIHJlc3VsdCA9ICIiOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgcmVzdWx0ICs9IChTdHJpbmcuZnJvbUNoYXJDb2RlKGFycmF5W2ldKSk7DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQp9DQoNCmV4cG9ydHMuaGFuZGxlciA9IGZ1bmN0aW9uIChjb250ZXh0LCBldmVudCkgew0KICAgIHZhciBfZXZlbnQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGV2ZW50KSk7DQogICAgdmFyIF9kYXRhID0gYmluMnN0cmluZyhfZXZlbnQuYm9keS5kYXRhKTsNCiAgICANCiAgDQogICAgDQogICAgaWYoX2RhdGE9PSJyYWluIiAmJiBjb3Zlcj09ImNvdmVyX29mZiIpew0KICAgIAlpZihwb3dlcj09ImxpZ2h0X29uIil7DQogICAgICAgICAgCXBvd2VyPSJsaWdodF9vZmYiDQogICAgCQljb3Zlcj0iY292ZXJfb24iDQogICAgICAgCQlzZW5kX3RvX3RocmVlX3RvcGljX21xdHQoQ09WRVJfVE9QSUMsIExJR0hUX1RPUElDLFBIT05FX1RPUElDLCBjb3ZlciwgcG93ZXIsIkl0J3Mgc3RhcnRpbmcgdG8gcmFpbiEgSSBjbG9zZSB0aGUgcG9vbC4iKQ0KICAgICAgIAkJY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2sge3RlbXBlcmF0dXJlOiAiICsgdGVtcGVyYXR1cmUgKyAiLCBjb3ZlcjogIiArIGNvdmVyICsgIiwgbGlnaHQ6ICIgKyBwb3dlciArICJ9IikNCiAgICAgICAJfWVsc2V7DQogICAgICAgCQljb3Zlcj0iY292ZXJfb24iDQogICAgICAgCQlzZW5kX3RvX3R3b190b3BpY19tcXR0KENPVkVSX1RPUElDLFBIT05FX1RPUElDLGNvdmVyLCJJdCdzIHN0YXJ0aW5nIHRvIHJhaW4hIEkgY2xvc2UgdGhlIHBvb2wuIikNCiAgICAgICAJCWNvbnRleHQuY2FsbGJhY2soImZlZWRiYWNrIHt0ZW1wZXJhdHVyZTogIiArIHRlbXBlcmF0dXJlICsgIiwgY292ZXI6ICIgKyBjb3ZlciArICIsIGxpZ2h0OiAiICsgcG93ZXIgKyAifSIpDQogICAgICAgICAgIH0NCiAgICB9DQoNCmlmKF9kYXRhPT0ibm90X3JhaW4iICYmIGNvdmVyPT0iY292ZXJfb24iICYmIHRlbXBlcmF0dXJlPk1JTl9URU1QRVJBVFVSRSl7DQogICAgCWlmKHN1bj09Im5vIiAmJiBwb3dlcj09ImxpZ2h0X29mZiIpew0KICAgIAkJcG93ZXI9ImxpZ2h0X29uIg0KICAgIAkJY292ZXI9ImNvdmVyX29mZiINCiAgICAgICAJCXNlbmRfdG9fZm91cl90b3BpY19tcXR0KENPVkVSX1RPUElDLCBMSUdIVF9UT1BJQyxDT0xPUl9UT1BJQyxQSE9ORV9UT1BJQywgY292ZXIsIHBvd2VyLGNvbG9yLCJUaGUgcmFpbiBpcyBvdmVyISBJIHJlb3BlbiB0aGUgcG9vbC4iKQ0KICAgICAgIAkJY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2sge3RlbXBlcmF0dXJlOiAiICsgdGVtcGVyYXR1cmUgKyAiLCBjb3ZlcjogIiArIGNvdmVyICsgIiwgbGlnaHQ6ICIgKyBwb3dlciArICJ9IikNCiAgICAgICAJfWVsc2V7DQogICAgICAgCQljb3Zlcj0iY292ZXJfb2ZmIg0KICAgICAgIAkJc2VuZF90b190d29fdG9waWNfbXF0dChDT1ZFUl9UT1BJQyxQSE9ORV9UT1BJQyxjb3ZlciwiVGhlIHJhaW4gaXMgb3ZlciEgSSByZW9wZW4gdGhlIHBvb2wuIikNCiAgICAgICAJCWNvbnRleHQuY2FsbGJhY2soImZlZWRiYWNrIHt0ZW1wZXJhdHVyZTogIiArIHRlbXBlcmF0dXJlICsgIiwgY292ZXI6ICIgKyBjb3ZlciArICIsIGxpZ2h0OiAiICsgcG93ZXIgKyAifSIpDQogICAgICAgfQ0KICAgIH0NCiAgIGlmKGNvdmVyPT0iY292ZXJfb24iICYmIHBvd2VyPT0ibGlnaHRfb24iKXsNCiAgICBwb3dlcj0ibGlnaHRfb2ZmIg0KICAgICBzZW5kX3RvX29uZV90b3BpY19tcXR0KExJR0hUX1RPUElDLHBvd2VyKSAgIA0KICAgIH0NCiAgICANCiAgICBpZighaXNOYU4oX2RhdGEpKXsNCgkgICAgdGVtcGVyYXR1cmU9IE51bWJlcihfZGF0YSkNCiAgICAgICAgICANCgkgICAgaWYodGVtcGVyYXR1cmU8TUlOX1RFTVBFUkFUVVJFICYmIGNvdmVyPT0iY292ZXJfb2ZmIil7DQogICAgICAgICAgICANCiAgICAgICAgIAlpZihwb3dlcj09ImxpZ2h0X29uIil7DQoJICAgIAkJcG93ZXI9ImxpZ2h0X29mZiINCgkgICAgCQljb3Zlcj0iY292ZXJfb24iDQoJICAgICAgIAkJc2VuZF90b190aHJlZV90b3BpY19tcXR0KENPVkVSX1RPUElDLCBMSUdIVF9UT1BJQyxQSE9ORV9UT1BJQyAsY292ZXIsIHBvd2VyLCJUaGUgdGVtcGVyYXR1cmUgaXMgdG9vIGxvdyEgSSBjbG9zZSB0aGUgcG9vbC4iKQ0KCSAgICAgICAJCWNvbnRleHQuY2FsbGJhY2soImZlZWRiYWNrIHt0ZW1wZXJhdHVyZTogIiArIHRlbXBlcmF0dXJlICsgIiwgY292ZXI6ICIgKyBjb3ZlciArICIsIGxpZ2h0OiAiICsgcG93ZXIgKyAifSIpDQoJICAgICAgIAl9ZWxzZXsNCgkgICAgICAgCQljb3Zlcj0iY292ZXJfb24iDQoJICAgICAgIAkJc2VuZF90b190d29fdG9waWNfbXF0dChDT1ZFUl9UT1BJQyxQSE9ORV9UT1BJQyxjb3ZlciwiVGhlIHRlbXBlcmF0dXJlIGlzIHRvbyBsb3chIEkgY2xvc2UgdGhlIHBvb2wuIikNCgkgICAgICAgCQljb250ZXh0LmNhbGxiYWNrKCJmZWVkYmFjayB7dGVtcGVyYXR1cmU6ICIgKyB0ZW1wZXJhdHVyZSArICIsIGNvdmVyOiAiICsgY292ZXIgKyAiLCBsaWdodDogIiArIHBvd2VyICsgIn0iKQ0KCSAgICAgICB9DQoJICAgIH0NCiAgICAgICAgaWYodGVtcGVyYXR1cmU+TUlOX1RFTVBFUkFUVVJFICYmIGNvdmVyPT0iY292ZXJfb24iKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgCWlmKHBvd2VyPT0ibGlnaHRfb2ZmIiAmJiBzdW49PSJubyIpew0KCSAgICAJCXBvd2VyPSJsaWdodF9vbiINCgkgICAgCQljb3Zlcj0iY292ZXJfb2ZmIg0KCSAgICAgICAJCXNlbmRfdG9fdGhyZWVfdG9waWNfbXF0dChDT1ZFUl9UT1BJQywgTElHSFRfVE9QSUMsUEhPTkVfVE9QSUMsIGNvdmVyLCBwb3dlciwiVGhlIHRlbXBlcmF0dXJlIGhhcyByaXNlbiEgSSByZW9wZW4gdGhlIHBvb2wuICIpDQoJICAgICAgIAkJY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2sge3RlbXBlcmF0dXJlOiAiICsgdGVtcGVyYXR1cmUgKyAiLCBjb3ZlcjogIiArIGNvdmVyICsgIiwgbGlnaHQ6ICIgKyBwb3dlciArICJ9IikNCgkgICAgICAgCX1lbHNlew0KCSAgICAgICAJCWNvdmVyPSJjb3Zlcl9vZmYiDQoJICAgICAgIAkJc2VuZF90b190d29fdG9waWNfbXF0dChDT1ZFUl9UT1BJQyxQSE9ORV9UT1BJQyxjb3ZlciwiVGhlIHRlbXBlcmF0dXJlIGhhcyByaXNlbiEgSSByZW9wZW4gdGhlIHBvb2wuIikNCgkgICAgICAgCQljb250ZXh0LmNhbGxiYWNrKCJmZWVkYmFjayB7dGVtcGVyYXR1cmU6ICIgKyB0ZW1wZXJhdHVyZSArICIsIGNvdmVyOiAiICsgY292ZXIgKyAiLCBsaWdodDogIiArIHBvd2VyICsgIn0iKQ0KCSAgICAgICB9DQoJICAgIH0NCiAgICANCiAgICB9DQogICAgDQogICAgDQogICAgaWYoX2RhdGE9PSJ5ZXMiICYmIHN1bj09Im5vIil7DQogICAgCXN1bj0ieWVzIg0KICAgIAlpZihwb3dlcj09ImxpZ2h0X29uIil7DQogICAgCQlwb3dlcj0ibGlnaHRfb2ZmIg0KICAgIAkJc2VuZF90b19vbmVfdG9waWNfbXF0dChMSUdIVF9UT1BJQyxQSE9ORV9UT1BJQyxwb3dlciwiSXQncyBzdW5ueSEgSSB0dXJuIG9mZiB0aGUgbGlnaHRzLiIpDQogICAgCQljb250ZXh0LmNhbGxiYWNrKCJmZWVkYmFjayB7dGVtcGVyYXR1cmU6ICIgKyB0ZW1wZXJhdHVyZSArICIsIGNvdmVyOiAiICsgY292ZXIgKyAiLCBsaWdodDogIiArIHBvd2VyICsgIn0iKQ0KICAgIAl9DQogICAgfQ0KICAgIA0KICAgIGlmKF9kYXRhPT0ibm8iICYmIHN1bj09InllcyIpew0KICAgIAlzdW49Im5vIg0KICAgIAlpZihwb3dlcj09ImxpZ2h0X29mZiIgJiYgY292ZXI9PSJjb3Zlcl9vZmYiKXsNCiAgICAJCXBvd2VyPSJsaWdodF9vbiINCiAgICAJCXNlbmRfdG9fdGhyZWVfdG9waWNfbXF0dChMSUdIVF9UT1BJQyxDT0xPUl9UT1BJQyxQSE9ORV9UT1BJQyxwb3dlcixjb2xvciwiVGhlcmUgaXMgbm90IHRoZSBzdW4hIEkgdHVybiBvbiB0aGUgbGlnaHRzLiIpDQogICAgCQljb250ZXh0LmNhbGxiYWNrKCJmZWVkYmFjayB7dGVtcGVyYXR1cmU6ICIgKyB0ZW1wZXJhdHVyZSArICIsIGNvdmVyOiAiICsgY292ZXIgKyAiLCBsaWdodDogIiArIHBvd2VyICsgIn0iKQ0KICAgIAl9DQogICAgfQ0KICAgIA0KICAgIGlmKF9kYXRhPT0ibGlnaHRfb24iICYmIGNvdmVyPT0iY292ZXJfb2ZmIil7DQogICAgCQlwb3dlcj0ibGlnaHRfb24iDQogICAgCQlzZW5kX3RvX3R3b190b3BpY19tcXR0KExJR0hUX1RPUElDLENPTE9SX1RPUElDLHBvd2VyLGNvbG9yKQ0KICAgIAkJY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2sge3RlbXBlcmF0dXJlOiAiICsgdGVtcGVyYXR1cmUgKyAiLCBjb3ZlcjogIiArIGNvdmVyICsgIiwgbGlnaHQ6ICIgKyBwb3dlciArICJ9IikNCiAgICB9DQogICAgaWYoX2RhdGE9PSJsaWdodF9vZmYiICYmIHBvd2VyPT0ibGlnaHRfb24iKXsNCiAgICAJcG93ZXI9ImxpZ2h0X29mZiINCiAgICAJc2VuZF90b19vbmVfdG9waWNfbXF0dChMSUdIVF9UT1BJQyxwb3dlcikNCiAgICAJY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2sge3RlbXBlcmF0dXJlOiAiICsgdGVtcGVyYXR1cmUgKyAiLCBjb3ZlcjogIiArIGNvdmVyICsgIiwgbGlnaHQ6ICIgKyBwb3dlciArICJ9IikNCiAgICB9DQp9
    commands:
      - 'npm install mqtt'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 50
  version: 1
